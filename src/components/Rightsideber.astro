---
const allPosts = await Astro.glob('../pages/posts/*.md');
import Headingsofblog from "../components/Headingsofblog.astro";
// 获取所有 Markdown 文件

// 获取当前页面路径并修正
// let currentPath = Astro.url.pathname;
// if (currentPath.endsWith('index.html')) {
//   currentPath = currentPath.slice(0, -'index.html'.length);
// }
// if (currentPath.endsWith('/')) {
//   currentPath = currentPath.slice(0, -1);
// }
// allPosts.map((post, index) => {
//             if (post.url === Astro.url.pathname){
//               const headings = post.getHeadings();
//           }})
---



<div class="pl-3 mt-3 text-sm 
max-h-screen lg:mt-0 lg:px-6">
  <h2 class="text-sm font-medium text-secondary-900">On this page</h2>
    <div class="mt-3 text-sm">
      <ul class="space-y-5 leading-normal">
        <!-- {allPosts.map((post, index) => {
            const headings = post.getHeadings();
            return headings.map((heading, headingIndex) => (
              <Headingsofblog 
                key={`${index}-${headingIndex}`} 
                url={`#${heading.slug}`} 
                getHeadings={heading.text} 
              />
            ));
          })} -->
          
          {allPosts.map((post, index) => {
            let currentPath = Astro.url.pathname;
              if (currentPath.endsWith('index.html')) {
                currentPath = currentPath.slice(0, -'index.html'.length);
              }
              if (currentPath.endsWith('/')) {
                currentPath = currentPath.slice(0, -1);
              }
            if (post.url === currentPath){
              const headings = post.getHeadings();
              return headings.map((heading, headingIndex) => (
              <Headingsofblog 
                url={`#${heading.slug}`} 
                getHeadings={heading.text} 
              />
            ))
            };
            
          })} 

          
          
    </ul>
    </div>
</div>


<script>
// console.log(Astro.url.pathname)

</script>