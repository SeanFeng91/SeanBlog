---
import "../styles/global.css";
import IndexLayout from '../layouts/IndexLayout.astro';

const allPosts = await Astro.glob('../pages/posts/*.{md,mdx}');

const achieved = await Astro.glob('../pages/posts/03Achieved.{md,mdx}');
const problems = await Astro.glob('../pages/posts/02ProblemsAndAims.{md,mdx}');

const pageTitle = "SeanBlog";
---

<IndexLayout pageTitle={pageTitle}>
	<div x-data="{isLoading:false, isFestive:false, isShowDetail:false}" slot="maindiv" class="container mx-auto px-4 py-8">
		<h1 class="text-4xl md:text-6xl font-bold text-center mb-8 bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-500">
			My Awesome Blog with <span class="text-yellow-500">Astro & Tailwind</span>
		</h1>

		<!-- Celebration button -->
		<div class="flex justify-center mb-12">
			<button 
				@click="isFestive = !isFestive" 
				class="bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold py-2 px-4 rounded-full shadow-lg hover:shadow-xl transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105"
			>
				<span x-text="isFestive ? 'Welcome!!' : 'Click to celebrate'"></span>
				<i class="fas fa-party-horn ml-2"></i>
			</button>
		</div>

		<!-- Confetti canvas -->
		<canvas 
			:class="isFestive ? 'opacity-100 translate-y-0 duration-1000' : 'opacity-0 -translate-y-full'" 
			id="my-canvas" 
			class="absolute top-0 left-0 w-full h-full pointer-events-none transition-all"
		></canvas>

		<!-- Animated text section -->
		<section class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-8 rounded-lg shadow-xl mb-12">
			<p class="tlt text-xl md:text-3xl text-center">
				is:inline解决了大问题啊。Particles、Fireworks、Matter、Anime、pace、Textillate.js打开了新天地啊
			</p>
		</section>

		<!-- Now Working on & What I have Got sections -->
		<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
			<!-- Now Working on -->
			<div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6">
				<h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">Now Working on:</h3>
				<div class="overflow-auto max-h-60 pr-2 custom-scrollbar">
					{problems.map((post, index) => {
						const headings = post.getHeadings();
						return headings.map((heading, headingIndex) => (
							<div class="flex items-center space-x-3 py-2 border-b border-gray-200 dark:border-gray-700 last:border-b-0">
								<input type="checkbox" id={`task-${index}-${headingIndex}`} class="form-checkbox h-5 w-5 text-blue-600 rounded focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600" />
								<label for={`task-${index}-${headingIndex}`} class="text-sm text-gray-700 dark:text-gray-300">{heading.text}</label>
							</div>
						));
					})}
				</div>
			</div>

			<!-- What I have Got -->
			<div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6">
				<h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">What I have Got:</h3>
				<div class="overflow-auto max-h-60 pr-2 custom-scrollbar">
					{achieved.map((post, index) => {
						const headings = post.getHeadings();
						return headings.map((heading, headingIndex) => (
							<p class="text-sm text-gray-700 dark:text-gray-300 py-2 border-b border-gray-200 dark:border-gray-700 last:border-b-0">
								{headingIndex+1}. {heading.text}
							</p>
						));
					})}
				</div>
			</div>
		</div>

		<!-- Blog posts grid -->
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20">
			{allPosts.map((indexcard, index) => (
				<div 
					data-aos="fade-up" 
					data-aos-offset="200" 
					data-aos-delay={index * 100}
					data-aos-duration="1000" 
					class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg transition-all duration-300 hover:shadow-2xl hover:-translate-y-2"
				>
					<div class="relative h-48">
						<img 
							class="w-full h-full object-cover" 
							src={indexcard.frontmatter.image?.url || "https://via.placeholder.com/400x200"} 
							alt={indexcard.frontmatter.image?.alt || "Blog post cover"}
						/>
						<div class="absolute top-0 right-0 bg-blue-500 text-white text-xs font-bold px-2 py-1 m-2 rounded">
							{new Date(indexcard.frontmatter.pubDate).toLocaleDateString()}
						</div>
					</div>
					<div class="p-6">
						<h2 class="text-xl font-bold mb-2 text-gray-800 dark:text-white hover:text-blue-500 transition-colors duration-200">
							<a href={indexcard.url}>{indexcard.frontmatter.title}</a>
						</h2>
						<p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
							{indexcard.frontmatter.description}
						</p>
						<div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
							<p class="flex items-center">
								<svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"></path></svg>
								{indexcard.frontmatter.author}
							</p>
							<a href={indexcard.url} class="text-blue-500 hover:text-blue-700 font-medium">Read more</a>
						</div>
					</div>
				</div>
			))}
		</div>

		<!-- Timeline section -->
		<div class="relative mt-20 mb-20">
			<div class="absolute left-1/2 transform -translate-x-1/2 h-full w-0.5 bg-gradient-to-b from-blue-400 via-purple-500 to-pink-500"></div>
			<div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-full w-4 h-4 rounded-full bg-blue-400"></div>
			<div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-full w-4 h-4 rounded-full bg-pink-500"></div>
			<div class="space-y-8">
				{allPosts.sort((a, b) => new Date(b.frontmatter.pubDate) - new Date(a.frontmatter.pubDate)).map((indexcard, index) => (
					<div 
						class="relative flex items-center"
						data-aos="fade-up"
						data-aos-duration="800"
						data-aos-delay={index * 150}
						style={`margin-top: ${index === 0 ? '0' : '-80px'}`}
					>
						<div class="absolute left-1/2 transform -translate-x-1/2 w-5 h-5 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 shadow-lg flex items-center justify-center z-10">
							<div class="w-3 h-3 rounded-full bg-white dark:bg-gray-800"></div>
						</div>
						<div class={`w-5/12 ${index % 2 === 0 ? 'mr-auto pr-8' : 'ml-auto pl-8'}`}>
							<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-all duration-300 hover:shadow-xl hover:-translate-y-1">
								<div class="relative h-40">
									<img 
										class="w-full h-full object-cover" 
										src={indexcard.frontmatter.image?.url || "https://via.placeholder.com/400x200"} 
										alt={indexcard.frontmatter.image?.alt || "Blog post cover"}
									/>
									<div class="absolute top-0 right-0 bg-blue-500 text-white text-xs font-bold px-2 py-1 m-2 rounded">
										{new Date(indexcard.frontmatter.pubDate).toLocaleDateString()}
									</div>
								</div>
								<div class="p-4">
									<h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2 line-clamp-2">
										<a href={indexcard.url} class="hover:text-blue-500 transition-colors duration-200">
											{indexcard.frontmatter.title}
										</a>
									</h3>
									<p class="text-sm text-gray-600 dark:text-gray-300 mb-3 line-clamp-2">
										{indexcard.frontmatter.description}
									</p>
									<div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-400">
										<p class="flex items-center">
											<svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"></path></svg>
											{indexcard.frontmatter.author}
										</p>
										<a href={indexcard.url} class="text-blue-500 hover:text-blue-700 hover:underline font-medium">Read more</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				))}
			</div>
		</div>
	</div>
</IndexLayout>

<style>
.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #555;
}

@media (prefers-color-scheme: dark) {
  .custom-scrollbar::-webkit-scrollbar-track {
    background: #2d3748;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #4a5568;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #718096;
  }
}
</style>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script is:inline src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script is:inline> 
  AOS.init();
</script>

<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v6.0.0-beta3/css/all.css" />
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>

<script type="module">
	document.addEventListener('DOMContentLoaded', (event) => {
        let confettiElement = document.getElementById('my-canvas');
        if (confettiElement) {
            let confettiSettings = { target: confettiElement };
            let confetti = new ConfettiGenerator(confettiSettings);
            confetti.render();
        } else {
            console.error('Element with ID "my-canvas" not found');
        }
    });
</script>

<script type="module" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.7.0/jquery.lettering.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" integrity="sha512-YTL2qFiv2wZNnC764l1DD5zN6lYxDzJ89Ss6zj6YoYIzr6+zwjdVKM1sUR+971X3h7qWCa9cPUBXyYqhOqWWLQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script type="module" src="https://cdn.rawgit.com/jschr/textillate/master/jquery.textillate.js"></script>
<script type="module">
    $(document).ready(function () {
        $('.tlt').textillate({
            selector: '.texts',
            loop: true,
            minDisplayTime: 2000,
            initialDelay: 0,
            autoStart: true,
            inEffects: ['fadeIn'],
            outEffects: ['fadeOut'],
            in: {
                effect: 'fadeInUp',
                delayScale: 1.5,
                delay: 50,
                sync: false,
                shuffle: true
            },
            out: {
                effect: 'fadeOutDown',
                delayScale: 1.5,
                delay: 50,
                sync: false,
                shuffle: true
            }
        });
    });
</script>